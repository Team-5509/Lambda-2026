#!/bin/sh
set -e

# Try to find Java for environments like GitHub Desktop that might not have it in PATH
if ! command -v java >/dev/null 2>&1 && [ -z "$JAVA_HOME" ]; then
    # Check common WPILib locations
    if [ -d "C:/Users/Public/wpilib/2026/jdk" ]; then
        export JAVA_HOME="C:/Users/Public/wpilib/2026/jdk"
        export PATH="$JAVA_HOME/bin:$PATH"
    elif [ -d "C:/Users/Public/wpilib/2025/jdk" ]; then
        export JAVA_HOME="C:/Users/Public/wpilib/2025/jdk"
        export PATH="$JAVA_HOME/bin:$PATH"
    elif [ -d "$HOME/.jdk/jdk-17.0.16" ]; then
        export JAVA_HOME="$HOME/.jdk/jdk-17.0.16"
        export PATH="$JAVA_HOME/bin:$PATH"
    fi
fi

if [ "$PRE_COMMIT_SKIP_GRADLE_BUILD" = "true" ]; then
    echo "[pre-commit] Skipping Gradle builds"
else
    echo "[pre-commit] Running Gradle check..."
    # On Windows, use the batch file to avoid cygpath/exec issues in minimal bash environments
    if [ -f "gradlew.bat" ]; then
        ./gradlew.bat check
    else
        ./gradlew check
    fi
fi